// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Job {
  id          String   @id @default(uuid())
  url         String
  type        String   // 'auto', 'm3u8', 'file', 'youtube'
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  status      String   @default("queued") // 'queued', 'running', 'paused', 'failed', 'completed'
  stage       String?  // 'queue', 'download', 'merge', 'transcode', 'finalize'
  progress    Float    @default(0)       // 0-100
  speed       String?
  eta         Int?     // seconds
  totalBytes  BigInt?
  filename    String?
  outputPath  String?
  errorCode   String?
  errorMessage String?

  // JSON fields for flexible data
  meta        String?  // JSON string for metadata
  headers     String?  // JSON string for custom headers
  transcode   String?  // JSON string for transcode options

  @@map("jobs")
}

model Metric {
  id        String   @id @default(uuid())
  date      String   // YYYY-MM-DD format
  jobsTotal Int      @default(0)
  jobsCompleted Int  @default(0)
  jobsFailed Int     @default(0)
  bytesTotal BigInt  @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([date])
  @@map("metrics")
}